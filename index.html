<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnQuick ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* CSS: ‡¶Æ‡¶ø‡¶®‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶•‡¶ø‡¶Æ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Æ‡¶ø‡¶≤‡ßá ‡¶Ø‡¶æ‡¶Ø‡¶º */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--tg-theme-bg-color, #1c1c1c); 
            color: var(--tg-theme-text-color, #ffffff);
            transition: background-color 0.3s;
        }
        .header {
            text-align: center;
            padding: 20px 0;
        }
        .header h1 {
            margin: 0;
            font-size: 20px;
        }
        .balance-card {
            background-image: linear-gradient(135deg, var(--tg-theme-link-color, #007aff), var(--tg-theme-button-color, #00c6ff));
            color: var(--tg-theme-button-text-color, #ffffff);
            margin: 20px;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }
        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px;
        }
        .stat-card {
            background-color: var(--tg-theme-secondary-bg-color, #242424);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-card h3 {
            margin-top: 0;
            font-size: 14px;
            color: var(--tg-theme-hint-color, #aaaaaa);
        }
        .referral-box {
            background-color: var(--tg-theme-secondary-bg-color, #242424);
            margin: 20px;
            padding: 20px;
            border-radius: 10px;
        }
        .referral-link {
            background-color: var(--tg-theme-bg-color, #1c1c1c);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            word-break: break-all;
            font-size: 14px;
            color: var(--tg-theme-hint-color);
        }
        .action-buttons button {
            background-color: var(--tg-theme-button-color, #007aff);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            width: 48%;
            margin-top: 10px;
        }
        .action-buttons {
            display: flex;
            justify-content: space-between;
        }
        .footer-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: var(--tg-theme-secondary-bg-color, #242424);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid var(--tg-theme-separator-color, #333);
            z-index: 10;
        }
        .footer-nav div {
            text-align: center;
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }
        .ad-task-running {
            padding: 20px;
            text-align: center;
            font-size: 18px;
            color: var(--tg-theme-link-color);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 id="userName">‡¶á‡¶â‡¶ú‡¶æ‡¶∞: <span id="namePlaceholder">...</span> ‚úÖ</h1>
    </div>

    <div class="balance-card">
        <div>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ (‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü)</div>
        <h2 style="font-size: 30px;" id="userBalance">... ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü</h2>
    </div>

    <div class="stat-grid">
        <div class="stat-card" id="ad-task-card">
            <h3>‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ</h3>
            <p style="font-size: 24px;" id="adCounter">‡ß¶/‡ß¶</p>
            <button onclick="startAdTask()" id="adButton">Ad ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
        </div>
        <div class="stat-card">
            <h3>‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞</h3>
            <p style="font-size: 24px;" id="totalReferrals">‡ß¶</p>
        </div>
    </div>

    <div class="referral-box">
        <h3>üéÅ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
        <p>üëë ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá <span id="refBonus">...</span> ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</p>
        <div class="referral-link" id="refLink">‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        <div class="action-buttons">
            <button onclick="copyLink()">üîó ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button onclick="shareLink()">üì≤ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>
    
    <div class="footer-nav">
        <div>‡¶π‡ßã‡¶Æ</div>
        <div>‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</div>
        <div>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</div>
        <div>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</div>
        <div>‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</div>
    </div>

    <script>
        const WebApp = window.Telegram.WebApp;
        const BACKEND_URL = "https://earnquick-bot.onrender.com/data"; // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Render URL ‡¶è‡¶∞ /data ‡¶∞‡ßÅ‡¶ü

        WebApp.ready();
        WebApp.expand();
        
        const userId = WebApp.initDataUnsafe.user.id;
        const botUsername = '@EarnQuick_Official_bot'; 

        // --- ‡ßß. ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ---
        async function loadData() {
            document.getElementById('namePlaceholder').textContent = WebApp.initDataUnsafe.user.first_name;
            try {
                const response = await fetch(`${BACKEND_URL}?user_id=${userId}`);
                const data = await response.json();

                if (data.error) throw new Error(data.error);

                document.getElementById('userBalance').textContent = `${data.balance} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü`;
                document.getElementById('adCounter').textContent = `${data.daily_ads_seen}/${data.daily_ad_limit}`;
                document.getElementById('totalReferrals').textContent = data.total_referrals;
                document.getElementById('refBonus').textContent = `${data.referral_bonus_tk}.00`;

                // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø 
                const refLink = `https://t.me/${botUsername}?start=${userId}`;
                document.getElementById('refLink').textContent = refLink;

                // ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ï‡ßã‡¶ü‡¶æ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶≤‡ßá ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
                if (data.daily_ads_seen >= data.daily_ad_limit) {
                     document.getElementById('adButton').textContent = '‡¶ï‡ßã‡¶ü‡¶æ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ üö´';
                     document.getElementById('adButton').disabled = true;
                }

            } catch (error) {
                console.error("Failed to fetch dashboard data:", error);
                WebApp.showAlert("‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶¨‡¶ü‡¶ü‡¶ø ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
            }
        }

        // --- ‡ß®. ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ---
        function startAdTask() {
            const adCard = document.getElementById('ad-task-card');
            const button = document.getElementById('adButton');
            
            button.disabled = true;

            // ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Æ‡¶Ø‡¶º (‡¶Ø‡ßá‡¶Æ‡¶® ‡ßß‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°)
            let remainingTime = 15; 
            
            adCard.innerHTML = `<div class="ad-task-running" id="adTimer">üì¢ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶ö‡¶≤‡¶õ‡ßá... ${remainingTime}s</div>`;

            const timer = setInterval(() => {
                remainingTime--;
                document.getElementById('adTimer').textContent = `üì¢ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶ö‡¶≤‡¶õ‡ßá... ${remainingTime}s`;
                
                if (remainingTime <= 0) {
                    clearInterval(timer);
                    
                    // ‡ß©. ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶è‡¶®‡ßç‡¶°‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
                    const resultData = JSON.stringify({
                        action: "ad_completed",
                        ad_id: Date.now() 
                    });
                    
                    WebApp.sendData(resultData);
                    WebApp.close(); 
                }
            }, 1000); // 1 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá 1 ‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        }

        // --- ‡ß©. ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ---
        function copyLink() {
            const link = document.getElementById('refLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                WebApp.showAlert('üîó ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            });
        }

        function shareLink() {
            const link = document.getElementById('refLink').textContent;
            WebApp.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent('ü§ë EarnQuick-‡¶è ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®!')}`);
        }

        // --- ‡ß™. ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶® ---
        loadData();

    </script>
</body>
</html>
